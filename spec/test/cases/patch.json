[
  {
    "name": "patch_add_to_empty_object",
    "description": "Apply patch to add key to empty object",
    "category": "patch",
    "content_a": "@ [\"value\"]\n+ 42\n",
    "content_b": "{}",
    "args": ["-p"],
    "expected_diff": "{\"value\":42}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_object_key_addition",
    "description": "Patch adds a new key to existing object",
    "category": "patch",
    "content_a": "@ [\"b\"]\n+ 2\n",
    "content_b": "{\"a\":1}",
    "args": ["-p"],
    "expected_diff": "{\"a\":1,\"b\":2}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_object_key_removal",
    "description": "Patch removes a key from object",
    "category": "patch",
    "content_a": "@ [\"b\"]\n- 2\n",
    "content_b": "{\"a\":1,\"b\":2}",
    "args": ["-p"],
    "expected_diff": "{\"a\":1}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_object_value_change",
    "description": "Patch changes object value",
    "category": "patch",
    "content_a": "@ [\"a\"]\n- 1\n+ 2\n",
    "content_b": "{\"a\":1}",
    "args": ["-p"],
    "expected_diff": "{\"a\":2}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_nested_object",
    "description": "Patch changes nested object value",
    "category": "patch",
    "content_a": "@ [\"a\",\"b\"]\n- 1\n+ 2\n",
    "content_b": "{\"a\":{\"b\":1}}",
    "args": ["-p"],
    "expected_diff": "{\"a\":{\"b\":2}}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_array_element_with_context",
    "description": "Patch array element change with context validation",
    "category": "patch",
    "content_a": "@ [1]\n[\n  \"a\"\n- \"b\"\n+ \"x\"\n  \"c\"\n]\n",
    "content_b": "[\"a\",\"b\",\"c\"]",
    "args": ["-p"],
    "expected_diff": "[\"a\",\"x\",\"c\"]\n",
    "expected_exit": 0
  },
  {
    "name": "patch_array_append",
    "description": "Patch appends element to array",
    "category": "patch",
    "content_a": "@ [2]\n  2\n+ 3\n]\n",
    "content_b": "[1,2]",
    "args": ["-p"],
    "expected_diff": "[1,2,3]\n",
    "expected_exit": 0
  },
  {
    "name": "patch_array_prepend",
    "description": "Patch prepends element to array",
    "category": "patch",
    "content_a": "@ [0]\n[\n+ 0\n  1\n",
    "content_b": "[1,2]",
    "args": ["-p"],
    "expected_diff": "[0,1,2]\n",
    "expected_exit": 0
  },
  {
    "name": "patch_array_remove",
    "description": "Patch removes element from array",
    "category": "patch",
    "content_a": "@ [1]\n  1\n- 2\n  3\n",
    "content_b": "[1,2,3]",
    "args": ["-p"],
    "expected_diff": "[1,3]\n",
    "expected_exit": 0
  },
  {
    "name": "patch_set_option",
    "description": "Patch with SET option removes and adds set element",
    "category": "patch",
    "content_a": "^ \"SET\"\n@ [{}]\n- \"old\"\n+ \"new\"\n",
    "content_b": "[\"keep\",\"old\"]",
    "args": ["-p"],
    "expected_diff": "[\"new\",\"keep\"]\n",
    "expected_exit": 0
  },
  {
    "name": "patch_multiset_option",
    "description": "Patch with MULTISET option changes element counts",
    "category": "patch",
    "content_a": "^ \"MULTISET\"\n@ [[]]\n- 1\n+ 3\n",
    "content_b": "[1,1,2]",
    "args": ["-p"],
    "expected_diff": "[3,2,1]\n",
    "expected_exit": 0
  },
  {
    "name": "patch_precision_option",
    "description": "Patch with precision metadata header",
    "category": "patch",
    "content_a": "^ {\"precision\":0.1}\n@ [\"value\"]\n- 10\n+ 10.5\n",
    "content_b": "{\"value\":10}",
    "args": ["-p"],
    "expected_diff": "{\"value\":10.5}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_setkeys_option",
    "description": "Patch with SetKeys matches objects by key",
    "category": "patch",
    "content_a": "^ {\"setkeys\":[\"id\"]}\n@ [{\"id\":1},\"name\"]\n- \"Alice\"\n+ \"Bob\"\n",
    "content_b": "[{\"id\":1,\"name\":\"Alice\"}]",
    "args": ["-p"],
    "expected_diff": "[{\"id\":1,\"name\":\"Bob\"}]\n",
    "expected_exit": 0
  },
  {
    "name": "patch_deeply_nested",
    "description": "Patch changes deeply nested value",
    "category": "patch",
    "content_a": "@ [\"a\",\"b\",\"c\",\"d\"]\n- 1\n+ 2\n",
    "content_b": "{\"a\":{\"b\":{\"c\":{\"d\":1}}}}",
    "args": ["-p"],
    "expected_diff": "{\"a\":{\"b\":{\"c\":{\"d\":2}}}}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_multiple_hunks",
    "description": "Patch applies multiple hunks",
    "category": "patch",
    "content_a": "@ [\"a\"]\n- 1\n+ 10\n@ [\"b\"]\n- 2\n+ 20\n",
    "content_b": "{\"a\":1,\"b\":2}",
    "args": ["-p"],
    "expected_diff": "{\"a\":10,\"b\":20}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_noop",
    "description": "Patch with empty diff produces unchanged document",
    "category": "patch",
    "content_a": "",
    "content_b": "{\"a\":1}",
    "args": ["-p"],
    "expected_diff": "{\"a\":1}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_type_change",
    "description": "Patch changes value type from string to number",
    "category": "patch",
    "content_a": "@ [\"val\"]\n- \"str\"\n+ 42\n",
    "content_b": "{\"val\":\"str\"}",
    "args": ["-p"],
    "expected_diff": "{\"val\":42}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_null_to_value",
    "description": "Patch changes null to value",
    "category": "patch",
    "content_a": "@ [\"a\"]\n- null\n+ \"value\"\n",
    "content_b": "{\"a\":null}",
    "args": ["-p"],
    "expected_diff": "{\"a\":\"value\"}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_value_to_null",
    "description": "Patch changes value to null",
    "category": "patch",
    "content_a": "@ [\"a\"]\n- \"value\"\n+ null\n",
    "content_b": "{\"a\":\"value\"}",
    "args": ["-p"],
    "expected_diff": "{\"a\":null}\n",
    "expected_exit": 0
  },
  {
    "name": "patch_context_mismatch",
    "description": "Patch application fails with context mismatch",
    "category": "patch",
    "content_a": "@ [0]\n[\n  \"wrong\"\n- \"b\"\n+ \"x\"\n]\n",
    "content_b": "[\"a\",\"b\",\"c\"]",
    "args": ["-p"],
    "should_error": true,
    "expected_exit": 2
  },
  {
    "name": "patch_invalid_diff_syntax",
    "description": "Patch fails with malformed diff syntax",
    "category": "patch",
    "content_a": "@ [invalid path\n+ value\n",
    "content_b": "{}",
    "args": ["-p"],
    "should_error": true,
    "expected_exit": 2
  }
]
